<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/test/java/pt/feup/tvvs/pacman/viewer/ModelViewerWhiteBoxTests.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/test/java/pt/feup/tvvs/pacman/viewer/ModelViewerWhiteBoxTests.java" />
              <option name="originalContent" value="package pt.feup.tvvs.pacman.viewer;&#10;&#10;public class ModelViewerWhiteBoxTests {&#10;}&#10;" />
              <option name="updatedContent" value="package pt.feup.tvvs.pacman.viewer;&#10;&#10;import org.junit.jupiter.api.Test;&#10;import pt.feup.tvvs.pacman.gui.GUI;&#10;import pt.feup.tvvs.pacman.model.Element;&#10;import pt.feup.tvvs.pacman.model.Position;&#10;&#10;import java.io.IOException;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;&#10;import static org.assertj.core.api.Assertions.assertThat;&#10;import static org.assertj.core.api.Assertions.assertThatThrownBy;&#10;import static org.mockito.Mockito.*;&#10;&#10;public class ModelViewerWhiteBoxTests {&#10;&#10;    // tiny concrete Element subclass for testing&#10;    static class TestElement extends Element {&#10;        public TestElement(Position pos) {&#10;            super(pos);&#10;        }&#10;    }&#10;&#10;    @Test&#10;    public void drawElement_with_element_delegates_to_inner_viewer_if_present() {&#10;        @SuppressWarnings(&quot;unchecked&quot;)&#10;        Viewer&lt;Element&gt; inner = (Viewer&lt;Element&gt;) mock(Viewer.class);&#10;&#10;        Map&lt;Class&lt;?&gt;, Viewer&lt;Element&gt;&gt; map = new HashMap&lt;&gt;();&#10;        map.put(TestElement.class, inner);&#10;&#10;        ModelViewer&lt;TestElement&gt; mv = new ModelViewer&lt;&gt;(map) {&#10;            @Override&#10;            public void drawElements(GUI gui, TestElement model, long frameCount) {&#10;                // not used in this test&#10;            }&#10;        };&#10;&#10;        GUI gui = mock(GUI.class);&#10;        TestElement e = new TestElement(new Position(1, 2));&#10;&#10;        mv.drawElement(gui, (Element) e, 5L);&#10;&#10;        verify(inner).drawElement(gui, e, 5L);&#10;    }&#10;&#10;    @Test&#10;    public void drawElement_with_element_does_nothing_if_no_viewer() {&#10;        Map&lt;Class&lt;?&gt;, Viewer&lt;Element&gt;&gt; map = new HashMap&lt;&gt;();&#10;        ModelViewer&lt;TestElement&gt; mv = new ModelViewer&lt;&gt;(map) {&#10;            @Override&#10;            public void drawElements(GUI gui, TestElement model, long frameCount) {&#10;            }&#10;        };&#10;&#10;        GUI gui = mock(GUI.class);&#10;        TestElement e = new TestElement(new Position(0, 0));&#10;&#10;        // should not throw and not call any viewer&#10;        mv.drawElement(gui, (Element) e, 3L);&#10;&#10;        // nothing to verify on inner viewers since none exist; just assert no interactions on GUI&#10;        verifyNoInteractions(gui);&#10;    }&#10;&#10;    @Test&#10;    public void drawElement_with_model_clears_once_calls_drawElements_and_refresh() throws Exception {&#10;        Map&lt;Class&lt;?&gt;, Viewer&lt;Element&gt;&gt; map = new HashMap&lt;&gt;();&#10;&#10;        final boolean[] called = {false};&#10;&#10;        ModelViewer&lt;String&gt; mv = new ModelViewer&lt;&gt;(map) {&#10;            @Override&#10;            public void drawElements(GUI gui, String model, long frameCount) {&#10;                called[0] = true;&#10;            }&#10;        };&#10;&#10;        GUI gui = mock(GUI.class);&#10;        when(gui.getNextAction()).thenReturn(java.util.List.of()); // unused but harmless&#10;&#10;        mv.drawElement(gui, &quot;model&quot;, 1L);&#10;&#10;        verify(gui).clear();&#10;        verify(gui).refresh();&#10;        assertThat(called[0]).isTrue();&#10;&#10;        // second call should not clear again, but should refresh and call drawElements&#10;        called[0] = false;&#10;        mv.drawElement(gui, &quot;model2&quot;, 2L);&#10;        verify(gui, times(1)).clear();&#10;        verify(gui, times(2)).refresh();&#10;        assertThat(called[0]).isTrue();&#10;    }&#10;&#10;    @Test&#10;    public void drawElement_wraps_ioexception_from_refresh_in_runtimeexception() throws Exception {&#10;        Map&lt;Class&lt;?&gt;, Viewer&lt;Element&gt;&gt; map = new HashMap&lt;&gt;();&#10;&#10;        ModelViewer&lt;String&gt; mv = new ModelViewer&lt;&gt;(map) {&#10;            @Override&#10;            public void drawElements(GUI gui, String model, long frameCount) {&#10;                // do nothing&#10;            }&#10;        };&#10;&#10;        GUI gui = mock(GUI.class);&#10;        doThrow(new IOException(&quot;boom&quot;)).when(gui).refresh();&#10;&#10;        assertThatThrownBy(() -&gt; mv.drawElement(gui, &quot;m&quot;, 1L)).isInstanceOf(RuntimeException.class).hasMessageContaining(&quot;boom&quot;);&#10;&#10;        // ensure clear was still called before refresh&#10;        verify(gui).clear();&#10;        verify(gui).refresh();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>