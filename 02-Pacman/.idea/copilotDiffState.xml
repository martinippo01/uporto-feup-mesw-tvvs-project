<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/test/java/pt/feup/tvvs/pacman/GameWhiteBoxTests.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/test/java/pt/feup/tvvs/pacman/GameWhiteBoxTests.java" />
              <option name="originalContent" value="package pt.feup.tvvs.pacman;&#10;&#10;public class GameWhiteBoxTests {&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package pt.feup.tvvs.pacman;&#10;&#10;import org.junit.jupiter.api.AfterEach;&#10;import org.junit.jupiter.api.BeforeEach;&#10;import org.junit.jupiter.api.Test;&#10;import org.junit.jupiter.api.extension.ExtendWith;&#10;import org.mockito.junit.jupiter.MockitoExtension;&#10;import pt.feup.tvvs.pacman.audio.AudioManager;&#10;import pt.feup.tvvs.pacman.audio.AudioPlayer;&#10;import pt.feup.tvvs.pacman.gui.GUI;&#10;import pt.feup.tvvs.pacman.states.State;&#10;&#10;import java.lang.reflect.Field;&#10;&#10;import static org.assertj.core.api.Assertions.assertThat;&#10;import static org.assertj.core.api.Assertions.assertThatCode;&#10;import static org.mockito.Mockito.*;&#10;&#10;@ExtendWith(MockitoExtension.class)&#10;public class GameWhiteBoxTests {&#10;&#10;    @BeforeEach&#10;    public void resetSingletonBefore() throws Exception {&#10;        // ensure singleton is null before each test&#10;        Field instance = Game.class.getDeclaredField(&quot;instance&quot;);&#10;        instance.setAccessible(true);&#10;        instance.set(null, null);&#10;    }&#10;&#10;    @AfterEach&#10;    public void resetSingletonAfter() throws Exception {&#10;        Field instance = Game.class.getDeclaredField(&quot;instance&quot;);&#10;        instance.setAccessible(true);&#10;        instance.set(null, null);&#10;    }&#10;&#10;    @Test&#10;    public void getInstance_createsSingleton_setsMasterVolume_and_initialState() throws Exception {&#10;        GUI gui = mock(GUI.class);&#10;        when(gui.getResolution()).thenReturn(GUI.SCREEN_RESOLUTION._720p);&#10;&#10;        AudioManager audioManager = mock(AudioManager.class);&#10;        when(audioManager.getMasterVolume()).thenReturn(0.5f);&#10;&#10;        // ensure MenuController's calls to audioManager.getAudio(...) return mock AudioPlayer instances&#10;        AudioPlayer menuSelect = mock(AudioPlayer.class);&#10;        AudioPlayer menuConfirm = mock(AudioPlayer.class);&#10;        when(audioManager.getAudio(&quot;menuSelect&quot;)).thenReturn(menuSelect);&#10;        when(audioManager.getAudio(&quot;menuConfirmSelection&quot;)).thenReturn(menuConfirm);&#10;&#10;        Game game = Game.getInstance(gui, audioManager);&#10;&#10;        // same references returned&#10;        assertThat(game.getGui()).isSameAs(gui);&#10;        assertThat(game.getAudioManager()).isSameAs(audioManager);&#10;&#10;        // constructor should set master volume to 1f&#10;        verify(audioManager, times(1)).setMasterVolume(1f);&#10;&#10;        // state should be initialized (MainMenuState) - at least not null&#10;        assertThat(game.getState()).isNotNull();&#10;&#10;        // getInstance returns same singleton on subsequent calls&#10;        Game game2 = Game.getInstance(gui, audioManager);&#10;        assertThat(game2).isSameAs(game);&#10;    }&#10;&#10;    @Test&#10;    public void setAndGetState_workAsExpected() throws Exception {&#10;        GUI gui = mock(GUI.class);&#10;        when(gui.getResolution()).thenReturn(GUI.SCREEN_RESOLUTION._720p);&#10;        AudioManager audioManager = mock(AudioManager.class);&#10;        when(audioManager.getMasterVolume()).thenReturn(1f);&#10;&#10;        AudioPlayer menuSelect = mock(AudioPlayer.class);&#10;        AudioPlayer menuConfirm = mock(AudioPlayer.class);&#10;        when(audioManager.getAudio(&quot;menuSelect&quot;)).thenReturn(menuSelect);&#10;        when(audioManager.getAudio(&quot;menuConfirmSelection&quot;)).thenReturn(menuConfirm);&#10;&#10;        Game game = Game.getInstance(gui, audioManager);&#10;&#10;        State&lt;?&gt; fakeState = mock(State.class);&#10;        game.setState(fakeState);&#10;        assertThat(game.getState()).isSameAs(fakeState);&#10;    }&#10;&#10;    @Test&#10;    public void getResolution_delegatesToGui_and_setResolution_callsResizeScreen() throws Exception {&#10;        GUI gui = mock(GUI.class);&#10;        when(gui.getResolution()).thenReturn(GUI.SCREEN_RESOLUTION._540p);&#10;        AudioManager audioManager = mock(AudioManager.class);&#10;        when(audioManager.getMasterVolume()).thenReturn(1f);&#10;&#10;        AudioPlayer menuSelect = mock(AudioPlayer.class);&#10;        AudioPlayer menuConfirm = mock(AudioPlayer.class);&#10;        when(audioManager.getAudio(&quot;menuSelect&quot;)).thenReturn(menuSelect);&#10;        when(audioManager.getAudio(&quot;menuConfirmSelection&quot;)).thenReturn(menuConfirm);&#10;&#10;        Game game = Game.getInstance(gui, audioManager);&#10;&#10;        assertThat(game.getResolution()).isEqualTo(GUI.SCREEN_RESOLUTION._540p);&#10;&#10;        // call setResolution and verify gui.resizeScreen invoked with expected constants&#10;        GUI.SCREEN_RESOLUTION newRes = GUI.SCREEN_RESOLUTION._900p;&#10;        game.setResolution(newRes);&#10;&#10;        verify(gui, times(1)).resizeScreen(320, 180, newRes);&#10;    }&#10;&#10;    @Test&#10;    public void gameLoop_update_incrementsFrameCount() throws InterruptedException {&#10;        GameLoop loop = new GameLoop(1000); // frameTime = 1 ms&#10;&#10;        // frameCount should start at 0&#10;        assertThat(loop.getFrameCount()).isEqualTo(0);&#10;&#10;        // update with a no-op runnable&#10;        loop.update(() -&gt; {&#10;            // do nothing&#10;        });&#10;&#10;        assertThat(loop.getFrameCount()).isEqualTo(1);&#10;&#10;        // multiple updates increment further&#10;        loop.update(() -&gt; {});&#10;        assertThat(loop.getFrameCount()).isEqualTo(2);&#10;    }&#10;&#10;    @Test&#10;    public void getInstance_handlesMultipleThreads_and_isSingleton() throws Exception {&#10;        GUI gui = mock(GUI.class);&#10;        when(gui.getResolution()).thenReturn(GUI.SCREEN_RESOLUTION._720p);&#10;        AudioManager audioManager = mock(AudioManager.class);&#10;        when(audioManager.getMasterVolume()).thenReturn(1f);&#10;&#10;        AudioPlayer menuSelect = mock(AudioPlayer.class);&#10;        AudioPlayer menuConfirm = mock(AudioPlayer.class);&#10;        when(audioManager.getAudio(&quot;menuSelect&quot;)).thenReturn(menuSelect);&#10;        when(audioManager.getAudio(&quot;menuConfirmSelection&quot;)).thenReturn(menuConfirm);&#10;&#10;        // call getInstance concurrently - should still result in a single instance&#10;        Runnable r = () -&gt; assertThatCode(() -&gt; Game.getInstance(gui, audioManager)).doesNotThrowAnyException();&#10;        Thread t1 = new Thread(r);&#10;        Thread t2 = new Thread(r);&#10;        t1.start();&#10;        t2.start();&#10;        t1.join();&#10;        t2.join();&#10;&#10;        Game g = Game.getInstance(gui, audioManager);&#10;        assertThat(g).isNotNull();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>